<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph Algorithm Visualizer</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        :root {
            --primary-color: black;
            --primary-dark: black;
            --primary-light: black;
            --secondary-color: #4caf50;
            --text-primary: #212121;
            --text-secondary: #757575;
            --background-light: #fafafa;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --border-radius: 8px;
        }

        body {
    background: #f8f9fa;
    margin: 0;
    padding: 20px;
}

.header {
    margin-left: 145px;
    text-align: center;
    margin-bottom: 20px;
    padding: 10px 20px;
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
    position: relative;
    min-height: 80px;
    max-width: 1200px;
}

.back-button {
    text-decoration: none;
    color: var(--primary-color);
    font-weight: 500;
    display: inline-block;
    margin: 0;
    transition: color 0.3s;
    position: absolute;
    top: 10px;
    left: 20px;
    font-size: 0.9em;
    line-height: 1;
}

.back-button:hover {
    color: var(--primary-dark);
}

.header h1 {
    color: var(--text-primary);
    margin: 0 0 5px 0;
    font-size: 2em;
    font-weight: bold;
    line-height: 1.2;
}

.subtitle {
    color: var(--text-secondary);
    margin: 0;
    font-size: 1em;
    font-weight: normal;
    line-height: 1.4;
}

.visualization-container {
    width: 1250px;
    margin: 0 auto;
}

.control-panel {
    background: white;
    padding: 15px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
    margin-bottom: 15px;
}

.controls-wrapper {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.input-group {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
    margin-bottom: 15px;
}

.input-group input[type="text"],
.input-group input[type="number"] {
    padding: 8px 12px;
    border: 2px solid #e0e0e0;
    border-radius: 4px;
    font-size: 14px;
    flex: 1;
    min-width: 150px;
    transition: border-color 0.3s;
}

.input-group input[type="text"]:focus,
.input-group input[type="number"]:focus {
    border-color: var(--primary-color);
    outline: none;
}

.input-group button {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.3s;
}

.input-group button:hover {
    background: var(--primary-dark);
}

.speed-control {
    display: flex;
    align-items: center;
    gap: 5px;
}

.speed-control label {
    color: var(--text-secondary);
    font-weight: 500;
}

.speed-control input[type="range"] {
    flex: 1;
    max-width: 150px;
}

.visualization-area {
    background: white;
    padding: 15px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
    margin-bottom: 15px;
    min-height: 400px;
    overflow: auto;
}

.step-container {
    background: white;
    padding: 15px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
    margin-bottom: 15px;
    display: none;
    overflow: auto;
}

.step-container.active {
    display: block;
}

.step-header {
    color: var(--text-primary);
    font-weight: bold;
    margin: 0 0 10px 0;
    font-size: 1.1em;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.step-explanation {
    color: var(--text-secondary);
    font-size: 0.9em;
    margin-top: 10px;
}

.steps-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.step-navigation {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}

.step-navigation button {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.3s;
}

.step-navigation button:disabled {
    background: #e0e0e0;
    cursor: not-allowed;
}

.step-navigation button:hover:not(:disabled) {
    background: var(--primary-dark);
}

.step-navigation .step-counter {
    color: var(--text-secondary);
    font-size: 0.9em;
    min-width: 100px;
    text-align: center;
}

.play-pause-button {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.3s;
}

.play-pause-button:hover {
    background: var(--primary-dark);
}

/* Activity Selection Styles */
.timeline {
    height: 100px;
    padding: 8px;
    margin: 10px 0;
    position: relative;
}

.activity-stack {
    display: flex;
    flex-direction: column-reverse;
    align-items: center;
    gap: 5px;
    margin-top: 20px;
}

.activity-timeline {
    display: flex;
    flex-direction: column;
    gap: 5px;
    margin-top: 20px;
}

.activity {
    width: 80%;
    height: 35px;
    background: var(--primary-light);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.9em;
    transition: all 0.3s;
    box-shadow: var(--shadow-sm);
    position: relative;
}

.activity.selected {
    background: var(--secondary-color);
}

.activity.current {
    background: #3498db;
    transform: scale(1.1);
}

/* Knapsack Styles */
.items-container {
    height: 150px;
    padding: 8px;
    margin: 10px 0;
    display: flex;
    gap: 10px;
}

.item {
    flex: 1;
    background: var(--primary-light);
    min-height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.9em;
    border-radius: 4px;
    transition: all 0.3s;
    white-space: pre-wrap;
    text-align: center;
    box-shadow: var(--shadow-sm);
}

.item.selected {
    background: var(--secondary-color);
}

.item.current {
    background: #3498db;
    transform: scale(1.1);
}

/* Huffman Coding Styles */
.huffman-tree {
    position: relative;
    height: 600px;
    width: 100%;
    min-width: 900px;
    background: white;
    border-radius: var(--border-radius);
    padding: 40px;
    border: 1px solid #e0e0e0;
    overflow: visible;
    margin: 10px auto 30px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    box-shadow: var(--shadow-sm);
}

.huffman-node {
    position: absolute;
    width: 100px;
    height: 100px;
    background: var(--primary-color);
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2em;
    transition: all 0.3s;
    box-shadow: var(--shadow-md);
    transform: translate(-50%, -50%);
}

.huffman-node.leaf {
    background: var(--secondary-color);
}

.huffman-node.current {
    background: #3498db;
    transform: translate(-50%, -50%) scale(1.1);
}

.huffman-node .char {
    font-weight: bold;
    font-size: 1.8em;
    margin-bottom: 10px;
}

.huffman-node .freq {
    font-size: 1.1em;
    background: rgba(255, 255, 255, 0.25);
    padding: 5px 15px;
    border-radius: 20px;
}

.huffman-edge {
    position: absolute;
    background: #e0e0e0;
    height: 4px;
    transform-origin: 0 0;
    z-index: 1;
    opacity: 0.6;
    transition: all 0.3s;
    border-radius: 2px;
}

/* Coin Change Styles */
.coin-container {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    padding: 20px;
}

.coin {
    width: 70px;
    height: 70px;
    background: var(--primary-light);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1em;
    font-weight: 500;
    transition: all 0.3s;
    box-shadow: var(--shadow-sm);
}

.coin.selected {
    background: var(--secondary-color);
}

.coin.current {
    background: #3498db;
    transform: scale(1.1);
}

.coin-count {
    position: absolute;
    top: -8px;
    right: -8px;
    background: var(--primary-dark);
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    font-size: 0.8em;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Job Scheduling Styles */
.schedule-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
    padding: 20px;
}

.job {
    padding: 15px;
    background: var(--primary-light);
    border-radius: 4px;
    color: white;
    font-size: 0.9em;
    transition: all 0.3s;
    box-shadow: var(--shadow-sm);
}

.job.selected {
    background: var(--secondary-color);
}

.job.current {
    background: #3498db;
    transform: scale(1.1);
}

/* Platform Styles */
.platforms-container {
    height: 300px;
    padding: 15px;
    position: relative;
}

.platform {
    background: white;
    border-radius: 4px;
    padding: 15px;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s;
    position: relative;
    min-height: 60px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.platform-number {
    position: absolute;
    left: -10px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--primary-color);
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8em;
    font-weight: bold;
}

.train {
    background: var(--primary-light);
    border-radius: 4px;
    padding: 10px 15px;
    color: white;
    font-size: 0.9em;
    min-width: 120px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    box-shadow: var(--shadow-sm);
}

.train.arriving {
    background: var(--secondary-color);
}

.train.departing {
    background: var(--primary-color);
}

.train .time {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.8em;
    color: var(--text-primary);
    background: white;
    padding: 2px 6px;
    border-radius: 4px;
    box-shadow: var(--shadow-sm);
}

.platform-stats {
    display: flex;
    gap: 20px;
    margin-top: 20px;
    padding: 15px;
    background: white;
    border-radius: 4px;
    box-shadow: var(--shadow-sm);
}

.platform-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.platform-stat-label {
    font-size: 0.8em;
    color: var(--text-secondary);
    margin-bottom: 5px;
}

.platform-stat-value {
    font-size: 1.2em;
    font-weight: bold;
    color: var(--primary-color);
}

/* Info Panel Styles */
.info-panel {
    background: white;
    padding: 15px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
    margin-top: 15px;
}

.complexity {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.complexity-item {
    flex: 1;
    text-align: center;
    padding: 10px;
    background: var(--primary-light);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
    min-width: 200px;
}

.complexity-item .label {
    font-weight: bold;
    color: white;
    display: block;
    margin-bottom: 5px;
    font-size: 0.9em;
    text-transform: uppercase;
}

.complexity-item .value {
    font-family: 'Courier New', monospace;
    font-size: 1.1em;
    color: white;
}

.explanation h3 {
    color: var(--primary-dark);
    margin: 0 0 10px 0;
    font-size: 1.3em;
}

.explanation p {
    color: var(--text-secondary);
    font-size: 0.9em;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: var(--background-light);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .input-group {
        flex-direction: column;
    }

    .step-navigation {
        flex-direction: column;
        align-items: stretch;
    }

    .step-navigation button {
        width: 100%;
    }

    .visualization-area {
        min-height: 300px;
    }

    .huffman-tree {
        min-width: 600px;
        height: 450px;
        padding: 30px;
    }
}

@media (max-width: 480px) {
    body {
        padding: 10px;
    }

    .control-panel,
    .visualization-area,
    .step-container {
        padding: 10px;
    }

    .header h1 {
        font-size: 1.5em;
    }

    .subtitle {
        font-size: 0.9em;
    }
}
    </style>
</head>
<body>
    <div class="header">
        <a href="/" class="back-button">← Back to Algorithms</a>
        <h1>{{ algorithm_name }}</h1>
        <p class="subtitle">{{ algorithm_description }}</p>
    </div>

    <div class="visualization-container">
        <div class="control-panel">
            <div class="controls-wrapper">
                <div class="input-group">
                    {% if algorithm_id == 'greedy/activity' %}
                        <input type="text" id="startTimes" placeholder="Start times (e.g., 1,3,0,5,8,5)">
                        <input type="text" id="finishTimes" placeholder="Finish times (e.g., 2,4,6,7,9,9)">
                    {% elif algorithm_id == 'greedy/fractional-knapsack' %}
                        <input type="text" id="values" placeholder="Values (e.g., 60,100,120)">
                        <input type="text" id="weights" placeholder="Weights (e.g., 10,20,30)">
                        <input type="number" id="capacity" placeholder="Capacity">
                    {% elif algorithm_id == 'greedy/huffman' %}
                        <input type="text" id="chars" placeholder="Characters (e.g., a,b,c,d)">
                        <input type="text" id="freqs" placeholder="Frequencies (e.g., 5,1,6,3)">
                    {% elif algorithm_id == 'greedy/coin-change' %}
                        <input type="text" id="coins" placeholder="Coins (e.g., 1,2,5,10,20,50)">
                        <input type="number" id="amount" placeholder="Amount">
                    {% elif algorithm_id == 'greedy/job-scheduling' %}
                        <input type="text" id="jobs" placeholder="Jobs (e.g., 1,2,3,4)">
                        <input type="text" id="deadlines" placeholder="Deadlines (e.g., 4,1,1,1)">
                        <input type="text" id="profits" placeholder="Profits (e.g., 20,10,40,30)">
                    {% elif algorithm_id == 'greedy/platforms' %}
                        <input type="text" id="arrivals" placeholder="Arrival times (e.g., 900,940,950,1100,1500,1800)">
                        <input type="text" id="departures" placeholder="Departure times (e.g., 910,1200,1120,1130,1900,2000)">
                    {% endif %}
                    <button onclick="visualize('{{ algorithm_id }}')">Visualize</button>
                    <button onclick="generateRandomInput()">Random Input</button>
                    <button onclick="resetVisualization()">Reset</button>
                </div>
                <div class="speed-control">
                    <label for="speed">Speed:</label>
                    <input type="range" id="speed" min="1" max="5" value="3">
                </div>
            </div>
        </div>

        <div class="visualization-area">
            <div id="visualizationContainer" class="steps-grid"></div>
            <div class="info-panel">
                <div class="complexity">
                    <div class="complexity-item">
                        <span class="label">Time:</span>
                        <span class="value">{{ time_complexity }}</span>
                    </div>
                    <div class="complexity-item">
                        <span class="label">Space:</span>
                        <span class="value">{{ space_complexity }}</span>
                    </div>
                </div>
                <div class="explanation">
                    <h3>How it works</h3>
                    <p>{{ algorithm_explanation }}</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentVisualization = null;
        let currentStepIndex = 0;
        let visualizationSteps = [];
        const speedControl = document.getElementById('speed');
        let playInterval = null;

        function getDelay() {
            return 600 / speedControl.value;
        }

        function playSteps() {
            if (playInterval) return;
            playInterval = setInterval(() => {
                if (currentStepIndex < visualizationSteps.length - 1) {
                    showNextStep();
                } else {
                    clearInterval(playInterval);
                    playInterval = null;
                }
            }, getDelay());
        }

        function pauseSteps() {
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
            }
        }

        function createStepNavigation(totalSteps) {
            const nav = document.createElement('div');
            nav.className = 'step-navigation';

            const prevBtn = document.createElement('button');
            prevBtn.innerHTML = '← Previous';
            prevBtn.onclick = showPreviousStep;
            prevBtn.disabled = true;

            const counter = document.createElement('div');
            counter.className = 'step-counter';
            counter.textContent = `Step 1 of ${totalSteps}`;

            const nextBtn = document.createElement('button');
            nextBtn.innerHTML = 'Next →';
            nextBtn.onclick = showNextStep;
            nextBtn.disabled = totalSteps <= 1;

            const playPauseBtn = document.createElement('button');
            playPauseBtn.className = 'play-pause-button';
            playPauseBtn.innerHTML = 'Play';
            playPauseBtn.onclick = () => {
                if (playInterval) {
                    pauseSteps();
                    playPauseBtn.innerHTML = 'Play';
                } else {
                    playSteps();
                    playPauseBtn.innerHTML = 'Pause';
                }
            };

            nav.appendChild(prevBtn);
            nav.appendChild(counter);
            nav.appendChild(nextBtn);
            nav.appendChild(playPauseBtn);

            return nav;
        }

        function updateStepNavigation() {
            const nav = document.querySelector('.step-navigation');
            if (!nav) return;

            const [prevBtn, counter, nextBtn, playPauseBtn] = nav.children;
            prevBtn.disabled = currentStepIndex <= 0;
            nextBtn.disabled = currentStepIndex >= visualizationSteps.length - 1;
            counter.textContent = `Step ${currentStepIndex + 1} of ${visualizationSteps.length}`;
        }

        function showNextStep() {
            if (currentStepIndex < visualizationSteps.length - 1) {
                const currentStep = document.querySelectorAll('.step-container')[currentStepIndex];
                currentStep.classList.remove('active');

                currentStepIndex++;
                const nextStep = document.querySelectorAll('.step-container')[currentStepIndex];
                nextStep.classList.add('active');

                updateStepNavigation();
            }
        }

        function showPreviousStep() {
            if (currentStepIndex > 0) {
                const currentStep = document.querySelectorAll('.step-container')[currentStepIndex];
                currentStep.classList.remove('active');

                currentStepIndex--;
                const prevStep = document.querySelectorAll('.step-container')[currentStepIndex];
                prevStep.classList.add('active');

                updateStepNavigation();
            }
        }

        function showStep(index) {
            if (index >= 0 && index < visualizationSteps.length) {
                const currentStep = document.querySelectorAll('.step-container')[currentStepIndex];
                if (currentStep) {
                    currentStep.classList.remove('active');
                }

                currentStepIndex = index;
                const newStep = document.querySelectorAll('.step-container')[currentStepIndex];
                if (newStep) {
                    newStep.classList.add('active');
                }

                updateStepNavigation();
            }
        }

        function generateRandomInput() {
            const algorithmId = '{{ algorithm_id }}';

            if (algorithmId === 'greedy/activity') {
                const n = Math.floor(Math.random() * 4) + 4;  // 4-7 activities
                const startTimes = [];
                const finishTimes = [];

                for (let i = 0; i < n; i++) {
                    const start = Math.floor(Math.random() * 10);
                    const duration = Math.floor(Math.random() * 3) + 1;
                    startTimes.push(start);
                    finishTimes.push(start + duration);
                }

                document.getElementById('startTimes').value = startTimes.join(',');
                document.getElementById('finishTimes').value = finishTimes.join(',');
            }
            else if (algorithmId === 'greedy/fractional-knapsack') {
                const n = Math.floor(Math.random() * 3) + 3;  // 3-5 items
                const values = Array.from({length: n}, () => Math.floor(Math.random() * 100) + 1);
                const weights = Array.from({length: n}, () => Math.floor(Math.random() * 30) + 1);
                const capacity = Math.floor(Math.random() * 50) + 30;

                document.getElementById('values').value = values.join(',');
                document.getElementById('weights').value = weights.join(',');
                document.getElementById('capacity').value = capacity;
            }
            else if (algorithmId === 'greedy/huffman') {
                const chars = 'abcdefghijklmnopqrstuvwxyz';
                const n = Math.floor(Math.random() * 3) + 4;  // 4-6 characters
                const selectedChars = [];
                const freqs = [];

                for (let i = 0; i < n; i++) {
                    selectedChars.push(chars[Math.floor(Math.random() * chars.length)]);
                    freqs.push(Math.floor(Math.random() * 10) + 1);
                }

                document.getElementById('chars').value = selectedChars.join(',');
                document.getElementById('freqs').value = freqs.join(',');
            }
            else if (algorithmId === 'greedy/coin-change') {
                const coins = [1, 2, 5, 10, 20, 50];
                const amount = Math.floor(Math.random() * 100) + 1;

                document.getElementById('coins').value = coins.join(',');
                document.getElementById('amount').value = amount;
            }
            else if (algorithmId === 'greedy/job-scheduling') {
                const n = Math.floor(Math.random() * 3) + 4;  // 4-6 jobs
                const jobs = Array.from({length: n}, (_, i) => i + 1);
                const deadlines = Array.from({length: n}, () => Math.floor(Math.random() * n) + 1);
                const profits = Array.from({length: n}, () => Math.floor(Math.random() * 50) + 1);

                document.getElementById('jobs').value = jobs.join(',');
                document.getElementById('deadlines').value = deadlines.join(',');
                document.getElementById('profits').value = profits.join(',');
            }
            else if (algorithmId === 'greedy/platforms') {
                const n = Math.floor(Math.random() * 3) + 4;  // 4-6 trains
                const arrivals = [];
                const departures = [];

                for (let i = 0; i < n; i++) {
                    const arrival = Math.floor(Math.random() * 12) * 100 + Math.floor(Math.random() * 60);
                    const duration = Math.floor(Math.random() * 200) + 30;
                    arrivals.push(arrival);
                    departures.push(arrival + duration);
                }

                document.getElementById('arrivals').value = arrivals.join(',');
                document.getElementById('departures').value = departures.join(',');
            }
        }

        function createStepContainer(stepNumber, content, explanation) {
            const container = document.createElement('div');
            container.className = 'step-container';

            const header = document.createElement('div');
            header.className = 'step-header';
            header.innerHTML = `<span>Step ${stepNumber}</span>`;

            const explanationDiv = document.createElement('div');
            explanationDiv.className = 'step-explanation';
            explanationDiv.textContent = explanation || 'No explanation available';

            container.appendChild(header);
            container.appendChild(content);
            container.appendChild(explanationDiv);

            return container;
        }

        function displayVisualization(step, stepNumber) {
            if (!step) {
                console.error('Step data is undefined');
                return createStepContainer(stepNumber, document.createElement('div'), 'Invalid step data');
            }

            const stepContent = document.createElement('div');
            const algorithmId = '{{ algorithm_id }}';

            if (algorithmId === 'greedy/activity') {
                if (!step.activities || !step.start_times || !step.finish_times) {
                    console.error('Missing required activity data');
                    return createStepContainer(stepNumber, stepContent, 'Missing activity data');
                }

                const timelineContainer = document.createElement('div');
                timelineContainer.className = 'activity-timeline';

                step.activities.forEach(activity => {
                    if (typeof activity === 'undefined') return;

                    const activityElement = document.createElement('div');
                    activityElement.className = 'activity' + 
                        (Array.isArray(step.selected) && step.selected.includes(activity) ? ' selected' : '') +
                        (activity === step.current ? ' current' : '');
                    activityElement.style.left = `${(step.start_times[activity] || 0) * 10}%`;
                    activityElement.style.width = `${((step.finish_times[activity] || 0) - (step.start_times[activity] || 0)) * 10}%`;
                    activityElement.textContent = `Activity ${activity}`;
                    timelineContainer.appendChild(activityElement);
                });

                stepContent.appendChild(timelineContainer);
            }
            else if (algorithmId === 'greedy/fractional-knapsack') {
                if (!step.items || !step.values || !step.weights) {
                    console.error('Missing required knapsack data');
                    return createStepContainer(stepNumber, stepContent, 'Missing knapsack data');
                }

                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'items-container';

                step.items.forEach(item => {
                    if (typeof item === 'undefined') return;

                    const itemElement = document.createElement('div');
                    itemElement.className = 'item';

                    const selected = Array.isArray(step.selected) ? step.selected.find(([i, _]) => i === item) : null;
                    if (selected) {
                        itemElement.classList.add('selected');
                        itemElement.style.height = `${selected[1] * 100}%`;
                    }

                    if (item === step.current_item) {
                        itemElement.classList.add('current');
                    }

                    itemElement.textContent = `V:${step.values[item] || 0}\nW:${step.weights[item] || 0}`;
                    itemsContainer.appendChild(itemElement);
                });

                stepContent.appendChild(itemsContainer);
            }
            else if (algorithmId === 'greedy/huffman') {
                if (!step.nodes || !Array.isArray(step.nodes)) {
                    console.error('Missing required Huffman data');
                    return createStepContainer(stepNumber, stepContent, 'Missing Huffman data');
                }

                const treeContainer = document.createElement('div');
                treeContainer.className = 'huffman-tree';

                // Create nodes
                step.nodes.forEach(node => {
                    const nodeElement = document.createElement('div');
                    nodeElement.className = 'huffman-node' + 
                        (node.is_leaf ? ' leaf' : ' internal') +
                        (node.id === step.current ? ' current' : '');

                    nodeElement.style.left = `${node.x}px`;
                    nodeElement.style.top = `${node.y}px`;

                    // Add content
                    const charDiv = document.createElement('div');
                    charDiv.className = 'char';
                    charDiv.textContent = node.char || '';

                    const freqDiv = document.createElement('div');
                    freqDiv.className = 'freq';
                    freqDiv.textContent = node.freq;

                    nodeElement.appendChild(charDiv);
                    nodeElement.appendChild(freqDiv);

                    treeContainer.appendChild(nodeElement);
                });

                // Create edges
                if (step.edges && Array.isArray(step.edges)) {
                    step.edges.forEach(edge => {
                        const edgeElement = document.createElement('div');
                        edgeElement.className = 'huffman-edge';

                        const dx = edge.to_x - edge.from_x;
                        const dy = edge.to_y - edge.from_y;
                        const length = Math.sqrt(dx * dx + dy * dy);
                        const angle = Math.atan2(dy, dx);

                        edgeElement.style.width = `${length}px`;
                        edgeElement.style.left = `${edge.from_x}px`;
                        edgeElement.style.top = `${edge.from_y}px`;
                        edgeElement.style.transform = `rotate(${angle}rad)`;

                        treeContainer.appendChild(edgeElement);
                    });
                }

                stepContent.appendChild(treeContainer);
            }
            else if (algorithmId === 'greedy/coin-change') {
                if (!step.coins || !Array.isArray(step.selected)) {
                    console.error('Missing required coin change data');
                    return createStepContainer(stepNumber, stepContent, 'Missing coin data');
                }

                const coinContainer = document.createElement('div');
                coinContainer.className = 'coin-container';

                step.coins.forEach(coin => {
                    const coinElement = document.createElement('div');
                    coinElement.className = 'coin' + 
                        (step.selected.some(c => c === coin) ? ' selected' : '') +
                        (coin === step.current_coin ? ' current' : '');

                    const count = step.selected.filter(c => c === coin).length;
                    coinElement.textContent = coin;

                    if (count > 0) {
                        const countBadge = document.createElement('div');
                        countBadge.className = 'coin-count';
                        countBadge.textContent = count;
                        coinElement.appendChild(countBadge);
                    }

                    coinContainer.appendChild(coinElement);
                });

                const remainingDiv = document.createElement('div');
                remainingDiv.className = 'step-explanation';
                remainingDiv.textContent = `Remaining amount: ${step.remaining}`;

                stepContent.appendChild(coinContainer);
                stepContent.appendChild(remainingDiv);
            }
            else if (algorithmId === 'greedy/job-scheduling') {
                if (!step.jobs || !step.deadlines || !step.profits) {
                    console.error('Missing required job scheduling data');
                    return createStepContainer(stepNumber, stepContent, 'Missing job data');
                }

                const scheduleContainer = document.createElement('div');
                scheduleContainer.className = 'schedule-container';

                step.jobs.forEach((job, index) => {
                    const jobElement = document.createElement('div');
                    jobElement.className = 'job' + 
                        (Array.isArray(step.selected) && step.selected.includes(job) ? ' selected' : '') +
                        (job === step.current_job ? ' current' : '');

                    jobElement.innerHTML = `
                        <strong>Job ${job}</strong><br>
                        Deadline: ${step.deadlines[index]}<br>
                        Profit: ${step.profits[index]}
                    `;

                    scheduleContainer.appendChild(jobElement);
                });

                stepContent.appendChild(scheduleContainer);
            }
            else if (algorithmId === 'greedy/platforms') {
                if (!step.time || typeof step.current_platforms === 'undefined') {
                    console.error('Missing required platform data');
                    return createStepContainer(stepNumber, stepContent, 'Missing platform data');
                }

                const platformsContainer = document.createElement('div');
                platformsContainer.className = 'platforms-container';

                // Create platform rows
                for (let i = 0; i < step.max_platforms; i++) {
                    const platform = document.createElement('div');
                    platform.className = 'platform';
                    platform.style.top = `${i * 60 + 10}px`;
                    platform.textContent = `Platform ${i + 1}`;
                    platformsContainer.appendChild(platform);
                }

                // Add current event indicator
                const eventIndicator = document.createElement('div');
                eventIndicator.className = `train ${step.event_type}` + 
                    (step.event_type === 'arrival' || step.event_type === 'departure' ? ' current' : '');
                eventIndicator.style.left = `${(step.time / 2400) * 100}%`;
                eventIndicator.style.top = '10px';
                eventIndicator.textContent = `${step.time} (${step.event_type})`;
                platformsContainer.appendChild(eventIndicator);

                // Add platform stats
                const statsDiv = document.createElement('div');
                statsDiv.className = 'platform-stats';

                const currentStat = document.createElement('div');
                currentStat.className = 'platform-stat';
                currentStat.innerHTML = `
                    <div class="label">Current Platforms</div>
                    <div class="value">${step.current_platforms}</div>
                `;

                const maxStat = document.createElement('div');
                maxStat.className = 'platform-stat';
                maxStat.innerHTML = `
                    <div class="label">Maximum Needed</div>
                    <div class="value">${step.max_platforms}</div>
                `;

                statsDiv.appendChild(currentStat);
                statsDiv.appendChild(maxStat);
                platformsContainer.appendChild(statsDiv);

                stepContent.appendChild(platformsContainer);
            }

            return createStepContainer(stepNumber, stepContent, step.explanation);
        }

        async function visualize(algorithmId) {
            const container = document.getElementById('visualizationContainer');
            container.innerHTML = '';

            // Add special class for Huffman visualization
            const visualizationArea = container.closest('.visualization-area');
            if (visualizationArea) {
                visualizationArea.classList.remove('huffman');
                if (algorithmId === 'greedy/huffman') {
                    visualizationArea.classList.add('huffman');
                }
            }

            const data = {};

            try {
                if (algorithmId === 'greedy/activity') {
                    const startTimesStr = document.getElementById('startTimes').value.trim();
                    const finishTimesStr = document.getElementById('finishTimes').value.trim();

                    if (!startTimesStr || !finishTimesStr) {
                        throw new Error('Please enter both start times and finish times');
                    }

                    const startTimes = startTimesStr.split(',').map(Number);
                    const finishTimes = finishTimesStr.split(',').map(Number);

                    if (startTimes.some(isNaN) || finishTimes.some(isNaN)) {
                        throw new Error('Invalid input: Please enter valid numbers');
                    }

                    if (startTimes.length !== finishTimes.length) {
                        throw new Error('Number of start times must match number of finish times');
                    }

                    if (startTimes.length === 0) {
                        throw new Error('Please enter at least one activity');
                    }

                    // Validate that finish times are after start times
                    for (let i = 0; i < startTimes.length; i++) {
                        if (finishTimes[i] <= startTimes[i]) {
                            throw new Error(`Activity ${i}: Finish time must be after start time`);
                        }
                    }

                    data.start_times = startTimes;
                    data.finish_times = finishTimes;
                }
                else if (algorithmId === 'greedy/fractional-knapsack') {
                    const values = document.getElementById('values').value.split(',').map(Number);
                    const weights = document.getElementById('weights').value.split(',').map(Number);
                    const capacity = parseInt(document.getElementById('capacity').value);

                    if (values.some(isNaN) || weights.some(isNaN) || isNaN(capacity)) {
                        throw new Error('Invalid input: Please enter valid numbers');
                    }

                    data.values = values;
                    data.weights = weights;
                    data.capacity = capacity;
                }
                else if (algorithmId === 'greedy/huffman') {
                    data.chars = document.getElementById('chars').value.split(',');
                    data.freqs = document.getElementById('freqs').value.split(',').map(Number);
                }
                else if (algorithmId === 'greedy/coin-change') {
                    data.coins = document.getElementById('coins').value.split(',').map(Number);
                    data.amount = parseInt(document.getElementById('amount').value);
                }
                else if (algorithmId === 'greedy/job-scheduling') {
                    data.jobs = document.getElementById('jobs').value.split(',').map(Number);
                    data.deadlines = document.getElementById('deadlines').value.split(',').map(Number);
                    data.profits = document.getElementById('profits').value.split(',').map(Number);
                }
                else if (algorithmId === 'greedy/platforms') {
                    data.arrivals = document.getElementById('arrivals').value.split(',').map(Number);
                    data.departures = document.getElementById('departures').value.split(',').map(Number);
                }

                const response = await fetch(`/api/${algorithmId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const result = await response.json();

                if (!result || !Array.isArray(result.steps)) {
                    throw new Error('Invalid response from server');
                }

                // Store steps for navigation
                visualizationSteps = result.steps;
                currentStepIndex = 0;

                // Clear previous visualization
                container.innerHTML = '';

                // Add navigation controls
                const navigation = createStepNavigation(visualizationSteps.length);
                container.appendChild(navigation);

                // Create containers for all steps but only show the first one
                visualizationSteps.forEach((step, index) => {
                    const stepViz = displayVisualization(step, index + 1);
                    stepViz.classList.toggle('active', index === 0);
                    container.appendChild(stepViz);
                });

            } catch (error) {
                console.error('Visualization error:', error);
                container.innerHTML = `<div class="error" style="color: red; padding: 10px;">Error: ${error.message}</div>`;
            }
        }

        function resetVisualization() {
            const inputs = document.querySelectorAll('input[type="text"], input[type="number"]');
            inputs.forEach(input => input.value = '');

            document.getElementById('visualizationContainer').innerHTML = '';
        }

        // Initialize with random input
        generateRandomInput();
    </script>
</body>
</html>